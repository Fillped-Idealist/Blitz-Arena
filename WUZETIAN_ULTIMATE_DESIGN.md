# 武则天大招（天命法阵）设计文档

## 概述

武则天大招（原名：自动追踪）已重新设计为"天命法阵"技能，不再是投掷投射物，而是在怪物脚下直接生成精美的法阵，2秒后造成伤害。

---

## 技能特性

### 核心机制

1. **自动锁定**：每6秒自动锁定最近的N个怪物
2. **法阵生成**：在怪物脚下直接生成法阵（不移动）
3. **延迟伤害**：法阵持续2秒，结束时造成伤害
4. **华丽特效**：多层旋转光环、粒子特效、渐变发光

### 美术风格

#### 法阵设计
- **外层（金色）**：
  - 金色六边形法阵
  - 外圈光环（半径：50px，可升级）
  - 6条从中心向外的射线
  - 六边形顶点装饰（金色圆点）
  - 顺时针旋转

- **内层（紫色）**：
  - 紫色八边形法阵
  - 内圈光环（半径：30px）
  - 8条从中心向外的射线
  - 八边形顶点装饰（紫色圆点）
  - 逆时针旋转（速度是外层的1.5倍）

- **粒子系统**：
  - 24个旋转粒子
  - 金色和紫色交替
  - 从内圈向外圈移动
  - 粒子光晕效果

#### 视觉效果
1. **发光效果**：使用shadowBlur实现柔和发光
2. **渐变透明度**：法阵逐渐消失（2秒内从100%到0%）
3. **多层叠加**：外层和内层叠加，营造立体感
4. **动态旋转**：外层顺时针，内层逆时针，速度不同
5. **粒子动画**：粒子从中心向外扩散，带有旋转效果

---

## 技能升级系统

### 技能列表

#### 1. 天命法阵（解锁技能）
- **稀有度**：史诗（Epic）
- **效果**：解锁天命法阵技能
- **基础冷却**：6秒
- **基础半径**：50px
- **持续时间**：2秒
- **技能描述**：每6秒在最近敌人脚下召唤法阵，2秒后造成远程伤害（被动）

#### 2. 法阵精通系列（伤害提升）
- **法阵精通 I**（稀有）：伤害 +20%
- **法阵精通 II**（史诗）：伤害 +20%
- **法阵精通 III**（传说）：伤害 +20%
- **法阵精通 IV**（神话）：伤害 +20%
- **总提升**：最多 +80% 伤害

#### 3. 法阵加速系列（冷却降低）
- **法阵加速 I**（稀有）：冷却 -1秒
- **法阵加速 II**（史诗）：冷却 -1秒
- **法阵加速 III**（传说）：冷却 -1秒
- **最短冷却**：3秒

#### 4. 法阵多重系列（目标增加）
- **法阵多重 I**（传说）：同时锁定 +1个敌人
- **法阵多重 II**（神话）：同时锁定 +1个敌人
- **最多目标**：3个敌人

#### 5. 法阵扩张系列（范围扩大）
- **法阵扩张 I**（史诗）：范围 +30%
- **法阵扩张 II**（神话）：范围 +30%
- **最大半径**：85px（50 * 1.7）

---

## 技术实现

### 数据结构

```typescript
interface MagicCircle {
  id: number;
  monsterId: number;  // 锁定的怪物ID
  x: number;  // 怪物的当前位置
  y: number;
  damage: number;  // 法阵造成的伤害
  duration: number;  // 法阵持续时间
  startTime: number;  // 法阵开始时间
  radius: number;  // 法阵半径
  rotation: number;  // 当前旋转角度
  particles: {  // 法阵粒子
    angle: number;
    distance: number;
    speed: number;
    life: number;
    maxLife: number;
    color: string;
  }[];
}
```

### 绘制逻辑

1. **外层绘制**：
   - 绘制外圈（金色）
   - 绘制六边形（6条射线）
   - 绘制顶点装饰（6个圆点）
   - 应用旋转（顺时针）

2. **内层绘制**：
   - 绘制内圈（紫色）
   - 绘制八边形（8条射线）
   - 绘制顶点装饰（8个圆点）
   - 应用旋转（逆时针，速度1.5倍）

3. **粒子绘制**：
   - 绘制24个粒子
   - 粒子从内圈向外圈移动
   - 应用渐变透明度
   - 粒子光晕效果

### 伤害逻辑

```typescript
// 法阵持续时间结束时
if (elapsedSeconds >= circle.duration) {
  const monster = monstersRef.current.find(m => m.id === circle.monsterId);
  if (monster) {
    // 计算伤害（考虑精通、狂战士、巨人杀手等被动）
    let damage = circle.damage;
    
    // 狂战士被动
    if (hasBerserker && player.hp < player.maxHp * 0.5) {
      damage *= berserkerMultiplier;
    }
    
    // 巨人杀手被动
    if (hasGiantSlayer && (monster.type === 'boss' || monster.type === 'elite')) {
      damage *= 1.5;
    }
    
    // 护盾优先吸收
    if (monster.hasShield) {
      damage -= shieldAbsorption;
    }
    
    // 造成伤害
    monster.hp = Math.max(0, Math.floor(monster.hp - damage));
    
    // 视觉特效
    createParticles(monster.x, monster.y, '#F1C40F', 15, 'explosion');
    createParticles(monster.x, monster.y, '#9B59B6', 10, 'magic');
    createDamageNumber(monster.x, monster.y, damage, isCrit);
    triggerScreenShake(isCrit ? 2 : 1, 0.04);
    playSound(isCrit ? 'crit' : 'hit');
  }
}
```

---

## 与原版对比

| 特性 | 原版（自动追踪） | 新版（天命法阵） |
|------|------------------|------------------|
| 攻击方式 | 发射投射物 | 生成法阵 |
| 移动 | 需要飞行 | 固定在怪物脚下 |
| 命中时间 | 即时命中 | 延迟2秒 |
| 视觉效果 | 投射物轨迹 | 精美法阵 + 粒子 |
| 特效复杂度 | 简单 | 复杂（多层旋转） |
| 美术风格 | 单调 | 华丽（金色+紫色） |
| 范围扩大 | 穿透次数 | 法阵半径 |
| 技能名称 | 追踪精通 | 法阵精通 |
| 技能名称 | 追踪速度 | 法阵加速 |
| 技能名称 | 追踪多重 | 法阵多重 |
| 技能名称 | 追踪穿透 | 法阵扩张 |

---

## 视觉效果描述

### 法阵外观

**外层（金色六边形）**：
- 金色发光六边形
- 6条从中心向外的射线
- 每条射线末端有一个金色圆点
- 顺时针旋转，速度适中
- 半径50px（可升级至85px）

**内层（紫色八边形）**：
- 紫色发光八边形
- 8条从中心向外的射线
- 每条射线末端有一个紫色圆点
- 逆时针旋转，速度是外层的1.5倍
- 半径30px（固定）

**粒子系统**：
- 24个旋转粒子
- 金色和紫色交替（各12个）
- 粒子从内圈（30px）向外圈（50px）移动
- 每个粒子有独立的速度和方向
- 粒子有光晕效果（双层圆圈）
- 粒子渐变透明度（2秒内消失）

### 动画效果

1. **法阵生成**：
   - 瞬间在怪物脚下生成
   - 透明度从0%渐变到100%（快速）

2. **法阵持续**：
   - 外层顺时针旋转
   - 内层逆时针旋转（速度1.5倍）
   - 粒子从内圈向外圈移动
   - 透明度保持100%

3. **法阵消失**：
   - 透明度从100%渐变到0%（2秒内）
   - 旋转速度不变
   - 粒子逐渐消失

4. **伤害触发**：
   - 法阵消失瞬间
   - 金色和紫色爆炸粒子
   - 伤害数字显示
   - 屏幕轻微震动

---

## 游戏性影响

### 优势
1. **华丽视觉效果**：多层旋转法阵，粒子特效，视觉冲击力强
2. **延迟伤害**：2秒延迟增加策略性
3. **范围扩大**：通过升级可扩大法阵范围，提升视觉效果
4. **多目标锁定**：可同时锁定多个敌人，覆盖面广

### 挑战
1. **延迟伤害**：伤害需要等待2秒，不适合紧急情况
2. **怪物移动**：怪物可能移出法阵范围（但伤害仍然有效）
3. **节奏较慢**：相比投射物，法阵节奏较慢

### 策略建议
1. **配合其他技能**：与近战攻击、远程攻击配合使用
2. **针对Boss**：法阵适合对付移动速度慢的Boss
3. **群体控制**：法阵多重可同时锁定多个敌人
4. **范围升级**：法阵扩张可提升视觉效果和覆盖范围

---

## 性能影响

### 资源占用
- **法阵数量**：最多3个（同时锁定3个敌人）
- **粒子数量**：每个法阵24个粒子，最多72个粒子
- **绘制复杂度**：中等（多层旋转）

### 性能优化
- ✅ 法阵数量限制（最多3个）
- ✅ 粒子数量限制（每个法阵24个）
- ✅ 法阵持续时间限制（2秒）
- ✅ 法阵自动消失（持续时间结束）

---

## 未来改进方向

1. **法阵类型**：
   - 火焰法阵（红色）
   - 冰霜法阵（蓝色）
   - 雷电法阵（紫色）
   - 神圣法阵（金色）

2. **法阵效果**：
   - 减速效果
   - 冰冻效果
   - 持续伤害
   - 治疗效果

3. **法阵交互**：
   - 法阵之间叠加
   - 法阵与其他技能组合
   - 法阵连携效果

---

## 总结

武则天大招（天命法阵）重新设计后，具有：
- ✅ 精美的视觉效果（多层旋转 + 粒子特效）
- ✅ 华丽的美术风格（金色 + 紫色）
- ✅ 完整的升级系统（4个维度）
- ✅ 策略性的游戏玩法（延迟伤害）
- ✅ 良好的性能表现（资源占用可控）

**推荐状态：✅ 可以发布**
